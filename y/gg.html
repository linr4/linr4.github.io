<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>六十四卦定位练习</title>
    <style>
        body {
            font-family: "SimSun", "宋体", serif;
            margin: 10px;
            text-align: center;
        }
        .flashcard {
            margin: 4px auto;
            padding: 4px;
            border: 2px solid #333;
            border-radius: 8px;
            max-width: 100%;
            background-color: #f9f9f9;
        }
        .flashcard-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 0;
        }
        .symbol {
            font-size: 64px;
        }
        .name {
            font-size: 16px;
            writing-mode: vertical-rl;
            text-orientation: upright;
            line-height: 1.5;
            height: 5em;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }
        button {
            padding: 8px 16px;
            font-size: 14px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 8px;
        }
        button:hover {
            opacity: 0.9;
        }
        #next-btn {
            background-color: #4CAF50;
        }
        #toggle-btn {
            background-color: #2196F3;
        }
        .hint-text {
            font-size: 12px;
            color: #666;
            margin-top: 15px;
            line-height: 1.4;
            text-align: left;
            padding: 0; /* 修改为0 */
        }
        .hint-text ul {
            margin: 0;
            padding-left: 20px;
        }
        .hint-text li {
            margin-bottom: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 4px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
            padding: 6px;
        }
        .table-symbol {
            font-size: 18px;
            line-height: 1.2;
        }
        .hidden {
            display: none;
        }
        .highlight {
            background-color: #dff0d8;
        }
        .pure-gua {
            background-color: #e6f7ff;
        }
        .toggle-container {
            margin: 8px 0 0 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            padding: 0; /* 修改为0 */
        }
        .toggle-label {
            cursor: pointer;
            font-size: 12px;
            color: #666;
            margin: 0;
        }

        @media (max-width: 600px) {
            .symbol {
                font-size: 64px;
            }
            .name {
                font-size: 16px;
                line-height: 1.5;
                height: 5em;
                white-space: nowrap;
            }
            .hint-text {
                font-size: 11px;
            }
            table {
                font-size: 12px;
            }
            th, td {
                padding: 2px;
            }
            .table-symbol {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <h1 style="display:none;">六十四卦定位练习</h1>
    
    <div class="flashcard" id="flashcard">
        <div class="flashcard-container">
            <div class="symbol" id="symbol"></div>
            <div class="name" id="name"></div>
        </div>
        <p>这个卦应该在哪个宫位？</p>
        <button id="next-btn">下一个</button>
        <button id="toggle-btn">显示所有卦</button>
    </div>

    <div id="bagua-table"></div>

    <div class="toggle-container">
        <input type="checkbox" id="toggle-name-checkbox">
        <label for="toggle-name-checkbox" class="toggle-label">显示卦名全称</label>
    </div>
    
    <div class="hint-text">
        <div>
            <ul>
                <li>世应诀：天同二世天变五，地同四世地变初，本宫六世三世异，人同游魂人变归。</li>
                <li>寻宫诀：一二三六外卦宫，四五游魂内变更，归魂内卦是本宫。</li>
            </ul>
        </div>
    </div>

    <script>
        // 数据定义
        const lssg = ["䷀", "䷁", "䷂", "䷃", "䷄", "䷅", "䷆", "䷇", "䷈", "䷉", "䷊", "䷋", "䷌", "䷍", "䷎", "䷏", "䷐", "䷑", "䷒", "䷓", "䷔", "䷕", "䷖", "䷗", "䷘", "䷙", "䷚", "䷛", "䷜", "䷝", "䷞", "䷟", "䷠", "䷡", "䷢", "䷣", "䷤", "䷥", "䷦", "䷧", "䷨", "䷩", "䷪", "䷫", "䷬", "䷭", "䷮", "䷯", "䷰", "䷱", "䷲", "䷳", "䷴", "䷵", "䷶", "䷷", "䷸", "䷹", "䷺", "䷻", "䷼", "䷽", "䷾", "䷿"];
        const lssgm = ["乾為天", "坤為地", "水雷屯", "山水蒙", "水天需", "天水訟", "地水師", "水地比", "風天小畜", "天澤履", "地天泰", "天地否", "天火同人", "火天大有", "地山謙", "雷地豫", "澤雷隨", "山風蠱", "地澤臨", "風地觀", "火雷噬嗑", "山火賁", "山地剝", "地雷復", "天雷无妄", "山天大畜", "山雷頤", "澤風大過", "坎為水", "離為火", "澤山咸", "雷風恆", "天山遯", "雷天大壯", "火地晉", "地火明夷", "風火家人", "火澤睽", "水山蹇", "雷水解", "山澤損", "風雷益", "澤天夬", "天風姤", "泽地萃", "地风升", "泽水困", "水风井", "泽火革", "火风鼎", "震为雷", "艮为山", "风山渐", "雷泽归妹", "雷火丰", "火山旅", "巽为风", "兑为泽", "风水涣", "水泽节", "风泽中孚", "雷山小过", "水火既济", "火水未济"];
        const lssgm2 = ["乾", "坤", "屯", "蒙", "需", "訟", "師", "比", "小畜", "履", "泰", "否", "同人", "大有", "謙", "豫", "隨", "蠱", "臨", "觀", "噬嗑", "賁", "剝", "復", "无妄", "大畜", "頤", "大過", "坎", "離", "咸", "恆", "遯", "大壯", "晉", "明夷", "家人", "睽", "蹇", "解", "損", "益", "夬", "姤", "萃", "升", "困", "井", "革", "鼎", "震", "艮", "漸", "歸妹", "豐", "旅", "巽", "兌", "渙", "節", "中孚", "小過", "既濟", "未濟"];
        
        const bagong = [
            [1, 44, 33, 12, 20, 23, 35, 14],
            [2, 24, 19, 11, 34, 43, 5, 8],
            [52, 22, 26, 41, 38, 10, 61, 53],
            [58, 47, 45, 31, 39, 15, 62, 54],
            [30, 56, 50, 64, 4, 59, 6, 13],
            [29, 60, 3, 63, 49, 55, 36, 7],
            [51, 16, 40, 32, 46, 48, 28, 17],
            [57, 9, 37, 42, 25, 21, 27, 18]
        ];
        
        const headers = ['纯卦','一世','二世','三世','四世','五世','游魂','归魂'];
        let showFullName = false;

        // 创建表格
        function createBaguaTable() {
            const table = document.createElement('table');
            
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            const tbody = document.createElement('tbody');
            
            for (let i = 0; i < bagong.length; i++) {
                const row = document.createElement('tr');
                
                for (let j = 0; j < bagong[i].length; j++) {
                    const index = bagong[i][j] - 1;
                    const cell = document.createElement('td');
                    cell.dataset.guaIndex = index;
                    
                    const symbolDiv = document.createElement('div');
                    symbolDiv.className = 'table-symbol';
                    symbolDiv.textContent = lssg[index];
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.textContent = showFullName ? lssgm[index] : lssgm2[index];
                    
                    if (j === 0) {
                        cell.classList.add('pure-gua');
                    } else {
                        symbolDiv.classList.add('hidden');
                        nameDiv.classList.add('hidden');
                    }
                    
                    cell.appendChild(symbolDiv);
                    cell.appendChild(nameDiv);
                    row.appendChild(cell);
                }
                
                tbody.appendChild(row);
            }
            
            table.appendChild(tbody);
            return table;
        }

        // 更新表格中的卦名显示
        function updateTableNames() {
            const nameDivs = document.querySelectorAll('td div:not(.table-symbol)');
            nameDivs.forEach(div => {
                const index = parseInt(div.parentElement.dataset.guaIndex);
                div.textContent = showFullName ? lssgm[index] : lssgm2[index];
            });
        }

        // 渲染表格
        document.getElementById('bagua-table').appendChild(createBaguaTable());

        // 闪卡功能
        const symbolElement = document.getElementById('symbol');
        const nameElement = document.getElementById('name');
        const nextBtn = document.getElementById('next-btn');
        const toggleBtn = document.getElementById('toggle-btn');
        const toggleNameCheckbox = document.getElementById('toggle-name-checkbox');
        const tableCells = document.querySelectorAll('td');
        
        let askedIndices = [];
        let currentIndex = -1;
        let isShowingAll = false;
        
        function getRandomIndex() {
            const array = new Uint32Array(1);
            window.crypto.getRandomValues(array);
            return array[0] % lssg.length;
        }
        
        function getRandomGua() {
            if (askedIndices.length >= 10) {
                askedIndices = [];
            }
            
            let index;
            do {
                index = getRandomIndex();
            } while (askedIndices.includes(index) || isPureGua(index));
            
            askedIndices.push(index);
            return index;
        }
        
        function isPureGua(index) {
            for (let i = 0; i < bagong.length; i++) {
                if (bagong[i][0] - 1 === index) {
                    return true;
                }
            }
            return false;
        }
        
        function showRandomGua() {
            currentIndex = getRandomGua();
            symbolElement.textContent = lssg[currentIndex];
            nameElement.textContent = lssgm[currentIndex];
            
            tableCells.forEach(cell => {
                const guaIndex = parseInt(cell.dataset.guaIndex);
                const symbolDiv = cell.querySelector('.table-symbol');
                const nameDiv = cell.querySelector('div:not(.table-symbol)');
                
                cell.classList.remove('highlight');
                cell.style.backgroundColor = '';
                
                if (!cell.classList.contains('pure-gua') && !isShowingAll) {
                    symbolDiv.classList.add('hidden');
                    nameDiv.classList.add('hidden');
                }
            });
        }
        
        function toggleAllGua() {
            isShowingAll = !isShowingAll;
            toggleBtn.textContent = isShowingAll ? '隐藏其他卦' : '显示所有卦';
            
            tableCells.forEach(cell => {
                if (!cell.classList.contains('pure-gua')) {
                    const symbolDiv = cell.querySelector('.table-symbol');
                    const nameDiv = cell.querySelector('div:not(.table-symbol)');
                    
                    if (isShowingAll) {
                        symbolDiv.classList.remove('hidden');
                        nameDiv.classList.remove('hidden');
                    } else {
                        symbolDiv.classList.add('hidden');
                        nameDiv.classList.add('hidden');
                    }
                }
            });
        }

        function toggleNameDisplay() {
            showFullName = toggleNameCheckbox.checked;
            updateTableNames();
        }
        
        function handleCellClick(event) {
            if (currentIndex === -1) return;
            
            const cell = event.currentTarget;
            const guaIndex = parseInt(cell.dataset.guaIndex);
            
            if (cell.classList.contains('pure-gua')) {
                return;
            }
            
            const symbolDiv = cell.querySelector('.table-symbol');
            const nameDiv = cell.querySelector('div:not(.table-symbol)');
            symbolDiv.classList.remove('hidden');
            nameDiv.classList.remove('hidden');
            
            if (guaIndex === currentIndex) {
                cell.classList.add('highlight');
            } else {
                cell.style.backgroundColor = '#ffcdd2';
            }
        }
        
        // 初始化
        showRandomGua();
        
        // 事件监听
        nextBtn.addEventListener('click', showRandomGua);
        toggleBtn.addEventListener('click', toggleAllGua);
        toggleNameCheckbox.addEventListener('change', toggleNameDisplay);
        tableCells.forEach(cell => {
            cell.addEventListener('click', handleCellClick);
        });
    </script>
</body>
</html>
