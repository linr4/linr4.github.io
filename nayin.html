<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>六十甲子纳音记忆卡片</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        .card {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .question {
            font-size: 24px;
            margin: 20px 0;
        }
        .options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .option {
            background-color: #eaeaea;
            border: none;
            border-radius: 5px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .option:hover {
            background-color: #d0d0d0;
        }
        .option.correct {
            background-color: #a8f0a8;
        }
        .option.incorrect {
            background-color: #f0a8a8;
        }
        .feedback {
            font-size: 18px;
            margin: 10px 0;
            height: 24px;
        }
        .stats {
            margin-top: 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>六十甲子纳音记忆卡片</h1>
    <div class="card">
        <div class="question" id="question"></div>
        <div class="options" id="options"></div>
        <div class="feedback" id="feedback"></div>
    </div>
    <div class="stats" id="stats">已答题: 0/100 | 正确: 0</div>

    <script>
        // 六十甲子及其对应的纳音
        const ganZhiList = [
            { ganZhi: '甲子', nayin: '海中金' },
            { ganZhi: '乙丑', nayin: '海中金' },
            { ganZhi: '丙寅', nayin: '炉中火' },
            { ganZhi: '丁卯', nayin: '炉中火' },
            { ganZhi: '戊辰', nayin: '大林木' },
            { ganZhi: '己巳', nayin: '大林木' },
            { ganZhi: '庚午', nayin: '路旁土' },
            { ganZhi: '辛未', nayin: '路旁土' },
            { ganZhi: '壬申', nayin: '剑锋金' },
            { ganZhi: '癸酉', nayin: '剑锋金' },
            { ganZhi: '甲戌', nayin: '山头火' },
            { ganZhi: '乙亥', nayin: '山头火' },
            { ganZhi: '丙子', nayin: '涧下水' },
            { ganZhi: '丁丑', nayin: '涧下水' },
            { ganZhi: '戊寅', nayin: '城头土' },
            { ganZhi: '己卯', nayin: '城头土' },
            { ganZhi: '庚辰', nayin: '白腊金' },
            { ganZhi: '辛巳', nayin: '白腊金' },
            { ganZhi: '壬午', nayin: '杨柳木' },
            { ganZhi: '癸未', nayin: '杨柳木' },
            { ganZhi: '甲申', nayin: '井泉水' },
            { ganZhi: '乙酉', nayin: '井泉水' },
            { ganZhi: '丙戌', nayin: '屋上土' },
            { ganZhi: '丁亥', nayin: '屋上土' },
            { ganZhi: '戊子', nayin: '霹雳火' },
            { ganZhi: '己丑', nayin: '霹雳火' },
            { ganZhi: '庚寅', nayin: '松柏木' },
            { ganZhi: '辛卯', nayin: '松柏木' },
            { ganZhi: '壬辰', nayin: '长流水' },
            { ganZhi: '癸巳', nayin: '长流水' },
            { ganZhi: '甲午', nayin: '沙中金' },
            { ganZhi: '乙未', nayin: '沙中金' },
            { ganZhi: '丙申', nayin: '山下火' },
            { ganZhi: '丁酉', nayin: '山下火' },
            { ganZhi: '戊戌', nayin: '平地木' },
            { ganZhi: '己亥', nayin: '平地木' },
            { ganZhi: '庚子', nayin: '壁上土' },
            { ganZhi: '辛丑', nayin: '壁上土' },
            { ganZhi: '壬寅', nayin: '金箔金' },
            { ganZhi: '癸卯', nayin: '金箔金' },
            { ganZhi: '甲辰', nayin: '佛灯火' },
            { ganZhi: '乙巳', nayin: '佛灯火' },
            { ganZhi: '丙午', nayin: '天河水' },
            { ganZhi: '丁未', nayin: '天河水' },
            { ganZhi: '戊申', nayin: '大驿土' },
            { ganZhi: '己酉', nayin: '大驿土' },
            { ganZhi: '庚戌', nayin: '钗钏金' },
            { ganZhi: '辛亥', nayin: '钗钏金' },
            { ganZhi: '壬子', nayin: '桑柘木' },
            { ganZhi: '癸丑', nayin: '桑柘木' },
            { ganZhi: '甲寅', nayin: '大溪水' },
            { ganZhi: '乙卯', nayin: '大溪水' },
            { ganZhi: '丙辰', nayin: '沙中土' },
            { ganZhi: '丁巳', nayin: '沙中土' },
            { ganZhi: '戊午', nayin: '天上火' },
            { ganZhi: '己未', nayin: '天上火' },
            { ganZhi: '庚申', nayin: '石榴木' },
            { ganZhi: '辛酉', nayin: '石榴木' },
            { ganZhi: '壬戌', nayin: '大海水' },
            { ganZhi: '癸亥', nayin: '大海水' }
        ];

        // 获取加密安全的随机数
        function getCryptoRandomInt(min, max) {
            const range = max - min + 1;
            const maxRange = 0xFFFFFFFF; // 2^32 - 1
            let randomValue;
            
            do {
                randomValue = crypto.getRandomValues(new Uint32Array(1))[0];
            } while (randomValue > maxRange - (maxRange % range));
            
            return min + (randomValue % range);
        }

        // 从数组中随机选择n个不重复的元素
        function getRandomItems(array, n) {
            const result = [];
            const arrayCopy = [...array];
            const len = arrayCopy.length;
            
            for (let i = 0; i < n && i < len; i++) {
                const randomIndex = getCryptoRandomInt(0, arrayCopy.length - 1);
                result.push(arrayCopy[randomIndex]);
                arrayCopy.splice(randomIndex, 1);
            }
            
            return result;
        }

        // 生成错误选项
        function generateWrongOptions(correctAnswer, allOptions) {
            let wrongOptions = [];
            const allPossibleOptions = allOptions.filter(opt => opt !== correctAnswer);
            
            while (wrongOptions.length < 5) {
                if (allPossibleOptions.length === 0) break;
                
                const randomIndex = getCryptoRandomInt(0, allPossibleOptions.length - 1);
                const option = allPossibleOptions[randomIndex];
                wrongOptions.push(option);
                allPossibleOptions.splice(randomIndex, 1);
            }
            
            for (let i = wrongOptions.length - 1; i > 0; i--) {
                const j = getCryptoRandomInt(0, i);
                [wrongOptions[i], wrongOptions[j]] = [wrongOptions[j], wrongOptions[i]];
            }
            
            return [...wrongOptions, correctAnswer];
        }

        // 打乱数组顺序
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = getCryptoRandomInt(0, i);
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // 游戏状态
        let askedQuestions = [];
        let correctCount = 0;
        let totalQuestions = 0;

        // 生成干支问题
        function generateGanZhiQuestion() {
            const availableQuestions = ganZhiList.filter(item => 
                !askedQuestions.some(q => q.ganZhi === item.ganZhi && q.type === 'ganZhi')
            );
            
            if (availableQuestions.length === 0) {
                askedQuestions = askedQuestions.filter(q => q.type !== 'ganZhi');
                if (askedQuestions.length === 0) {
                    return null;
                }
                return generateGanZhiQuestion();
            }
            
            const randomIndex = getCryptoRandomInt(0, availableQuestions.length - 1);
            const selectedGanZhi = availableQuestions[randomIndex];
            
            askedQuestions.push({ ganZhi: selectedGanZhi.ganZhi, type: 'ganZhi' });
            
            const allNayins = [...new Set(ganZhiList.map(item => item.nayin))];
            const wrongOptions = generateWrongOptions(selectedGanZhi.nayin, allNayins);
            
            const shuffledOptions = shuffleArray(wrongOptions);
            
            return {
                type: 'ganZhi',
                question: `${selectedGanZhi.ganZhi}对应的纳音是？`,
                options: shuffledOptions,
                correctAnswer: selectedGanZhi.nayin
            };
        }

        // 生成纳音问题
        function generateNayinQuestion() {
            const availableQuestions = ganZhiList.filter(item => 
                !askedQuestions.some(q => q.nayin === item.nayin && q.type === 'nayin')
            );
            
            if (availableQuestions.length === 0) {
                askedQuestions = askedQuestions.filter(q => q.type !== 'nayin');
                if (askedQuestions.length === 0) {
                    return null;
                }
                return generateNayinQuestion();
            }
            
            const nayins = [...new Set(ganZhiList.map(item => item.nayin))];
            const randomNayinIndex = getCryptoRandomInt(0, nayins.length - 1);
            const selectedNayin = nayins[randomNayinIndex];
            
            const matchingGanZhis = ganZhiList.filter(item => item.nayin === selectedNayin);
            
            askedQuestions.push({ nayin: selectedNayin, type: 'nayin' });
            
            const correctOptions = matchingGanZhis.map(item => item.ganZhi);
            
            const wrongOptions = ganZhiList
                .filter(item => item.nayin !== selectedNayin)
                .map(item => item.ganZhi);
            
            const selectedWrongOptions = getRandomItems(wrongOptions, 5);
            
            const allOptions = [...selectedWrongOptions, ...correctOptions];
            const shuffledOptions = shuffleArray(allOptions);
            
            return {
                type: 'nayin',
                question: `${selectedNayin}对应的干支是？`,
                options: shuffledOptions,
                correctAnswers: correctOptions  // 修改为存储所有正确答案
            };
        }

        // 生成问题
        function generateQuestion() {
            const isGanZhiQuestion = getCryptoRandomInt(0, 1) === 0;
            
            let question;
            if (isGanZhiQuestion) {
                question = generateGanZhiQuestion();
                if (!question) {
                    question = generateNayinQuestion();
                }
            } else {
                question = generateNayinQuestion();
                if (!question) {
                    question = generateGanZhiQuestion();
                }
            }
            
            return question || null;
        }

        // 显示问题
        function displayQuestion(question) {
            document.getElementById('question').textContent = question.question;
            
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option';
                button.textContent = option;
                button.addEventListener('click', () => {
                    if (question.type === 'nayin') {
                        checkAnswer(option, question.correctAnswers);  // 传入所有正确答案
                    } else {
                        checkAnswer(option, [question.correctAnswer]);
                    }
                });
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('feedback').textContent = '';
        }

        // 检查答案
        function checkAnswer(selectedOption, correctAnswers) {
            const options = document.querySelectorAll('.option');
            let isCorrect = false;
            
            options.forEach(option => {
                if (correctAnswers.includes(option.textContent)) {
                    option.classList.add('correct');
                    if (option.textContent === selectedOption) {
                        isCorrect = true;
                    }
                } else if (option.textContent === selectedOption) {
                    option.classList.add('incorrect');
                }
                
                option.disabled = true;
            });
            
            totalQuestions++;
            if (isCorrect) {
                correctCount++;
            }
            
            document.getElementById('stats').textContent = `已答题: ${totalQuestions}/100 | 正确: ${correctCount}`;
            
            setTimeout(() => {
                if (totalQuestions < 101) {
                    showNextQuestion();
                } else {
                    document.getElementById('question').textContent = '测试完成！';
                    document.getElementById('options').innerHTML = '';
                    document.getElementById('feedback').textContent = `最终成绩: ${correctCount}/100`;
                }
            }, 2500);
        }

        // 显示下一题
        function showNextQuestion() {
            const question = generateQuestion();
            if (question) {
                displayQuestion(question);
            } else {
                document.getElementById('question').textContent = '没有更多问题了！';
                document.getElementById('options').innerHTML = '';
                document.getElementById('feedback').textContent = '';
            }
        }

        // 开始测试
        showNextQuestion();
    </script>
</body>
</html>